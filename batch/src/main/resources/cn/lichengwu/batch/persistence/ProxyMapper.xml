<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.lichengwu.batch.persistence.ProxyMapper">

    <cache/>

    <sql id="proxyFullColumn">
        id,status,type,inet_ntoa(ip) as ip,port,username,password,add_time as addTime,update_time as updateTime,response_time,note
    </sql>

    <resultMap id="proxyList" type="Proxy" autoMapping="true">
        <id property="id" column="id"/>
        <result property="updateTime" column="update_time"/>
        <result property="addTime" column="add_time"/>
    </resultMap>

    <select id="findById" resultType="Proxy" parameterType="int">
        SELECT
        <include refid="proxyFullColumn"></include>
        from proxy where id=#{id}
    </select>

    <select id="findByIp" resultType="Proxy" parameterType="string">
        SELECT
        <include refid="proxyFullColumn"/>
        from proxy where inet_ntoa(ip)=#{ip}

    </select>

    <insert id="insert" parameterType="cn.lichengwu.batch.domain.Proxy">
        INSERT INTO proxy
        (status,ip,port,type,username,password,add_time,update_time,response_time,note)
        VALUES
        (#{status},inet_aton(#{ip}),#{port},#{type},#{username},#{password},#{addTime},#{updateTime},#{responseTime},#{note})
    </insert>

    <select id="findAll" resultType="Proxy">
        select
        <include refid="proxyFullColumn"/>
        from proxy
    </select>

    <select id="getTopProxy" resultType="Proxy" parameterType="int">
        select
        <include refid="proxyFullColumn"/>
        from proxy
        where type=1 and status in (1,3) order by response_time asc limit #{topN}
    </select>

    <update id="update" parameterType="Proxy">
        UPDATE proxy
        SET
        status = #{status},
        type = #{type},
        ip = #{ip},
        port = #{port},
        username = #{username},
        password = #{password},
        add_time = #{addTime},
        update_time = #{updateTime},
        response_time = #{responseTime},
        note = #{note}
        WHERE id=${id};
    </update>

</mapper>